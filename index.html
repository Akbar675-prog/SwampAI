<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Swampy AI - Chatbot</title>
    <meta property="og:image" content="https://od.lk/s/OTlfNzQzOTkyMjdf/Screenshot_20251109_114139_CapCut.png">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://swamp-ai.vercel.app">
    <meta property="og:description" content="Swampy AI, adalah AI dengan fitur lengkap yang telah diverifikasi oleh Google LLC.">
    <link rel="icon" href="https://od.lk/s/OTlfNzQzOTkyMjdf/Screenshot_20251109_114139_CapCut.png" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    
    <!-- Google OAuth Client -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg-primary: #fafafa; --bg-secondary: #ffffff; --bg-tertiary: #f5f5f5; --bg-card: #ffffff;
            --text-primary: #000000; --text-secondary: #737373; --text-muted: #a3a3a3;
            --border: #e5e5e5; --accent: #0ea5e9; --accent-hover: #0284c7;
            --gradient-primary: linear-gradient(135deg, #0ea5e9 0%, #2563eb 100%);
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 20px 40px rgba(0, 0, 0, 0.1);
            --user-message: #0ea5e9; --bot-message: #f5f5f5; --success: #10b981; --error: #ef4444;
            --code-bg: #0d1117; --code-text: #d4d4d4;
            --glass-bg: rgba(255, 255, 255, 0.15);
            --glass-border: rgba(255, 255, 255, 0.25);
            --glass-glow: rgba(14, 165, 233, 0.3);
        }
        [data-theme="dark"] {
            --bg-primary: #000000; --bg-secondary: #0a0a0a; --bg-tertiary: #1a1a1a; --bg-card: #121212;
            --text-primary: #ffffff; --text-secondary: #a3a3a3; --text-muted: #737373; --border: #262626;
            --shadow-sm: 0 1px 3px rgba(255, 255, 255, 0.02);
            --shadow-md: 0 4px 12px rgba(255, 255, 255, 0.03);
            --shadow-lg: 0 20px 40px rgba(255, 255, 255, 0.05);
            --bot-message: #1a1a1a;
            --glass-bg: rgba(30, 30, 30, 0.3);
            --glass-border: rgba(255, 255, 255, 0.15);
            --glass-glow: rgba(14, 165, 233, 0.2);
        }

        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes typing { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        @keyframes ripple { 0% { transform: scale(0); opacity: 1; } 100% { transform: scale(4); opacity: 0; } }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.3s ease;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            -webkit-font-smoothing: antialiased;
        }

        .container {
            flex: 1;
            display: flex;
            flex-direction: column;
            max-width: 1000px;
            width: 100%;
            margin: 0 auto;
            padding: 1rem;
            animation: fadeIn 0.6s ease-out;
        }

        /* === LIQUID GLASS (iOS 26 STYLE) === */
        .chat-container {
            position: relative;
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--glass-bg);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            overflow: hidden;
            box-shadow: var(--shadow-md);
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            animation: slideUp 0.6s ease-out 0.1s both;
            max-height: calc(100vh - 280px);
            min-height: 400px;
        }

        .chat-container::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(135deg,
                rgba(14, 165, 233, 0.12) 0%,
                rgba(37, 99, 235, 0.06) 50%,
                rgba(14, 165, 233, 0.12) 100%
            );
            border-radius: 24px;
            z-index: -1;
            transition: all 0.4s ease;
            pointer-events: none;
        }

        .chat-container:hover {
            transform: translateY(-6px);
            box-shadow: 0 32px 64px rgba(0, 0, 0, 0.18);
            border-color: var(--glass-glow);
        }

        .chat-container:hover::before {
            background: linear-gradient(135deg,
                rgba(14, 165, 233, 0.25) 0%,
                rgba(37, 99, 235, 0.15) 50%,
                rgba(14, 165, 233, 0.25) 100%
            );
        }

        /* === EFEK KLIK HANYA DI TOMBOL ROBOT === */
        .model-btn {
            position: relative;
            overflow: hidden;
        }

        .model-btn::after {
            content: '';
            position: absolute;
            width: 0; height: 0;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.4s ease, height 0.4s ease;
            pointer-events: none;
            z-index: 1;
        }

        .model-btn.pressed::after {
            width: 80px;
            height: 80px;
        }

        [data-theme="dark"] .model-btn::after {
            background: rgba(255, 255, 255, 0.3);
        }

        /* === HEADER & CHAT === */
        .chat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 1.25rem;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(8px);
            border-bottom: 1px solid var(--glass-border);
            z-index: 2;
        }

        .chat-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .bot-avatar {
            width: 40px;
            height: 40px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.25rem;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3);
        }

        .bot-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .bot-status {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .bot-name {
            font-weight: 700;
            font-size: 0.95rem;
            color: var(--text-primary);
        }

        .bot-online {
            font-size: 0.75rem;
            color: var(--success);
            display: flex;
            align-items: center;
            gap: 0.375rem;
        }

        .online-dot {
            width: 6px;
            height: 6px;
            background: var(--success);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .chat-actions {
            display: flex;
            gap: 0.5rem;
        }

        .action-btn {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(8px);
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .action-btn:hover {
            background: var(--accent);
            color: white;
            transform: scale(1.1);
            box-shadow: 0 4px 16px rgba(14, 165, 233, 0.4);
        }

        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-toggle {
            position: relative;
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            box-shadow: var(--shadow-md);
            min-width: 180px;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            margin-top: 0.5rem;
        }

        .dropdown-menu.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-item {
            padding: 0.75rem 1rem;
            font-size: 0.875rem;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s ease;
            border-bottom: 1px solid var(--border);
        }

        .dropdown-item:last-child {
            border-bottom: none;
            border-radius: 0 0 16px 16px;
        }

        .dropdown-item:first-child {
            border-radius: 16px 16px 0 0;
        }

        .dropdown-item:hover {
            background: var(--accent);
            color: white;
        }

        .dropdown-item.active {
            background: var(--gradient-primary);
            color: white;
            font-weight: 600;
        }

        .chatbox {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            background: transparent;
        }

        .message-wrapper {
            display: flex;
            gap: 0.75rem;
            animation: slideUp 0.3s ease-out;
            align-items: flex-start;
        }

        .message-wrapper.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            min-width: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 0.875rem;
            color: white;
            margin-top: 0.25rem;
            overflow: hidden;
        }

        .message-avatar.bot {
            background: var(--gradient-primary);
        }

        .message-avatar.user {
            background: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%);
        }

        .message-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .message-content {
            display: flex;
            flex-direction: column;
            gap: 0.375rem;
            max-width: calc(100% - 48px);
            min-width: 0;
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.75rem;
            color: var(--text-muted);
            padding: 0 0.25rem;
        }

        .message-wrapper.user .message-header {
            flex-direction: row-reverse;
        }

        .message-bubble {
            padding: 0.875rem 1.125rem;
            border-radius: 16px;
            font-size: 0.9rem;
            line-height: 1.6;
            word-wrap: break-word;
            overflow-wrap: break-word;
            word-break: break-word;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(8px);
            border: 1px solid var(--glass-border);
        }

        .message-bubble.user {
            background: var(--user-message);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message-bubble.bot {
            background: rgba(255, 255, 255, 0.15);
            color: var(--text-primary);
            border-bottom-left-radius: 4px;
        }

        .code-block {
            background: rgba(13, 17, 23, 0.8);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            overflow: hidden;
            margin: 0.75rem 0;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
        }

        .code-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .code-language {
            color: #58a6ff;
            font-weight: 600;
            text-transform: capitalize;
            font-size: 0.8rem;
            font-family: ui-monospace, SFMono-Regular, 'SF Mono', Menlo, monospace;
        }

        .code-copy-btn {
            padding: 0.4rem 0.8rem;
            background: rgba(14, 165, 233, 0.2);
            color: #58a6ff;
            border: 1px solid rgba(14, 165, 233, 0.4);
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: 600;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .code-copy-btn:hover {
            background: rgba(14, 165, 233, 0.3);
            border-color: rgba(14, 165, 233, 0.6);
        }

        .code-copy-btn.copied {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border-color: rgba(16, 185, 129, 0.4);
        }

        .code-content {
            overflow-x: auto;
        }

        .code-content pre {
            margin: 0;
            padding: 1rem;
            background: transparent;
        }

        .code-content code {
            display: block;
            color: var(--code-text);
            font-family: ui-monospace, SFMono-Regular, 'SF Mono', Menlo, monospace;
            font-size: 0.875rem;
            line-height: 1.5;
            white-space: pre;
        }

        .message-bubble code.inline-code {
            background: rgba(14, 165, 233, 0.15);
            color: #58a6ff;
            padding: 0.15rem 0.4rem;
            border-radius: 6px;
            font-family: ui-monospace, SFMono-Regular, 'SF Mono', Menlo, monospace;
            font-size: 0.875rem;
            border: 1px solid rgba(14, 165, 233, 0.25);
        }

        .message-link {
            color: var(--accent);
            text-decoration: underline;
            font-weight: 600;
            word-break: break-all;
            transition: color 0.2s ease;
        }

        .message-link:hover {
            color: var(--accent-hover);
            text-decoration: none;
        }

        .message-bubble.user .message-link {
            color: white;
            text-decoration: underline;
        }

        .message-bubble.user .message-link:hover {
            color: #e0f2fe;
        }

        .message-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.25rem;
            padding: 0 0.25rem;
            flex-wrap: wrap;
        }

        .message-action {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(8px);
            border: 1px solid var(--glass-border);
            color: var(--text-muted);
            cursor: pointer;
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 8px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.375rem;
        }

        .message-action:hover {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
            transform: scale(1.05);
        }

        .google-login-btn {
            background: #4285F4;
            color: white;
            border-radius: 8px;
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(66, 133, 244, 0.3);
        }

        .google-login-btn .g-icon {
            background: white;
            color: #4285F4;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
        }

        .typing-indicator {
            display: flex;
            gap: 0.75rem;
            animation: slideUp 0.3s ease-out;
        }

        .typing-dots {
            display: flex;
            align-items: center;
            gap: 0.375rem;
            padding: 0.875rem 1.125rem;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(8px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            border-bottom-left-radius: 4px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--text-muted);
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        .chat-input-container {
            padding: 1rem 1.25rem;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            border-top: 1px solid var(--glass-border);
            z-index: 2;
        }

        .suggested-prompts {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
            overflow-x: auto;
            padding-bottom: 0.5rem;
        }

        .prompt-chip {
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(8px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            font-size: 0.8rem;
            color: var(--text-secondary);
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s ease;
        }

        .prompt-chip:hover {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3);
        }

        .input-wrapper {
            display: flex;
            gap: 0.75rem;
            align-items: flex-end;
        }

        .input-field {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .input-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .char-counter {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .newline-hint {
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        textarea {
            width: 100%;
            min-height: 44px;
            max-height: 120px;
            padding: 0.75rem 1rem;
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(8px);
            color: var(--text-primary);
            font-size: 0.9rem;
            font-family: inherit;
            resize: none;
            transition: all 0.3s ease;
        }

        textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.2);
        }

        textarea::placeholder {
            color: var(--text-muted);
        }

        .input-actions {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .send-btn, .newline-btn {
            width: 44px;
            height: 44px;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.125rem;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(8px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .send-btn {
            background: var(--gradient-primary);
            color: white;
            box-shadow: 0 4px 12px rgba(14, 165, 233, 0.4);
        }

        .send-btn:hover:not(:disabled) {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(14, 165, 233, 0.5);
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .newline-btn {
            color: var(--text-primary);
            border: 1px solid var(--glass-border);
        }

        .newline-btn:hover {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
            transform: scale(1.05);
        }

        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
            animation: slideUp 0.6s ease-out 0.2s both;
        }

        .stat-card {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            box-shadow: var(--shadow-sm);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--glass-glow);
        }

        .stat-icon {
            width: 40px;
            height: 40px;
            background: var(--gradient-primary);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.125rem;
        }

        .stat-info {
            flex: 1;
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-bottom: 0.25rem;
        }

        .stat-value {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--glass-bg);
            backdrop-filter: blur(16px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 1rem 1.25rem;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 1rem;
            z-index: 10000;
            transform: translateY(150%);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            min-width: 300px;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1rem;
            flex-shrink: 0;
        }

        .toast-icon.success { background: var(--success); }
        .toast-icon.error { background: var(--error); }

        .toast-content { flex: 1; }
        .toast-title { font-weight: 600; margin-bottom: 0.25rem; font-size: 0.875rem; color: var(--text-primary); }
        .toast-message { font-size: 0.8rem; color: var(--text-secondary); }

        .welcome-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 3rem 1.5rem;
            gap: 1.5rem;
        }

        .welcome-icon {
            width: 200px;
            height: 200px;
            background: rgba(0,0,0,0.1);
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2.5rem;
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
            overflow: hidden;
            transition: all 0.3s ease;
            backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
        }

        .welcome-icon video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 24px;
        }

        .welcome-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .welcome-text {
            font-size: 0.95rem;
            color: var(--text-secondary);
            max-width: 400px;
        }

        .example-prompts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            width: 100%;
            max-width: 600px;
            margin-top: 1rem;
        }

        .example-prompt {
            padding: 1rem;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .example-prompt:hover {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(14, 165, 233, 0.3);
        }

        .example-prompt i {
            margin-bottom: 0.5rem;
            font-size: 1.25rem;
        }

        .example-prompt-text {
            font-size: 0.85rem;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .container { padding: 0.5rem; }
            .chat-container { max-height: calc(100vh - 220px); min-height: 450px; border-radius: 20px; }
            .chat-header { padding: 1rem; flex-wrap: wrap; gap: 0.75rem; }
            .bot-avatar { width: 38px; height: 38px; }
            .action-btn { width: 34px; height: 34px; font-size: 0.9rem; }
            .chatbox { padding: 1.25rem 1rem; gap: 1rem; }
            .message-avatar { width: 30px; height: 30px; min-width: 30px; font-size: 0.8rem; }
            .message-content { max-width: calc(100% - 38px); }
            .message-bubble { padding: 0.75rem 1rem; font-size: 0.875rem; }
            .chat-input-container { padding: 1rem; }
            .send-btn, .newline-btn { width: 48px; height: 48px; }
            .stats-bar { grid-template-columns: 1fr; }
            .toast { bottom: 1rem; right: 1rem; left: 1rem; min-width: auto; border-radius: 16px; }
        }

        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--glass-border); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }
        ::selection { background: rgba(14, 165, 233, 0.3); color: var(--text-primary); }
    </style>
</head>
<body>
    <div class="container">
        <div class="chat-container" id="chatContainer">
            <div class="chat-header">
                <div class="chat-info">
                    <div class="bot-avatar" id="botAvatar">
                        <!-- JS isi -->
                    </div>
                    <div class="bot-status">
                        <div class="bot-name">Swampy AI</div>
                        <div class="bot-online">
                            <span class="online-dot"></span>
                            <span>Online</span>
                        </div>
                    </div>
                </div>
                <div class="chat-actions">
                    <div class="dropdown" id="modelDropdown">
                        <button class="action-btn model-btn dropdown-toggle" title="Pilih Model">
                            <i class="fas fa-robot"></i>
                        </button>
                        <div class="dropdown-menu" id="modelMenu">
                            <div class="dropdown-item active" data-model="lumen">Lumen <small>Kreatif</small></div>
                            <div class="dropdown-item" data-model="echo">Echo <small>Ringkas</small></div>
                            <div class="dropdown-item" data-model="pulse">Pulse <small>Enerjik</small></div>
                            <div class="dropdown-item" data-model="aether">Aether <small>Formal</small></div>
                            <div class="dropdown-item" data-model="cipher">Cipher <small>Coding</small></div>
                            <div class="dropdown-item" data-model="drift">Drift <small>Santai</small></div>
                            <div class="dropdown-item" data-model="flux">Flux <small>Adaptif</small></div>
                            <div class="dropdown-item" data-model="zenith">Zenith <small>Pro</small></div>
                            <div class="dropdown-item" data-model="spectra">Spectra <small>Serba Guna</small></div>
                        </div>
                    </div>
                    <button class="action-btn" id="themeToggle" title="Ganti Tema">
                        <i class="fas fa-sun"></i>
                    </button>
                    <button class="action-btn" id="clearChat" title="Clear Chat">
                        <i class="fas fa-trash"></i>
                    </button>
                    <button class="action-btn" id="exportChat" title="Export Chat">
                        <i class="fas fa-download"></i>
                    </button>
                </div>
            </div>

            <div class="chatbox" id="chatbox">
                <div class="welcome-screen" id="welcomeScreen">
                    <div class="welcome-icon" id="welcomeIcon">
                        <i class="fas fa-comments"></i>
                    </div>
                    <div class="welcome-title">Welcome to Swampy AI!</div>
                    <div class="welcome-text">
                        Tanya apa saja! Saya bisa bantu coding, debug, dan banyak lagi.
                    </div>
                    <div class="example-prompts">
                        <div class="example-prompt" data-prompt="Jelaskan async/await">
                            <i class="fas fa-code"></i>
                            <div class="example-prompt-text">Jelaskan async/await</div>
                        </div>
                        <div class="example-prompt" data-prompt="Tulis fungsi sort Python">
                            <i class="fas fa-python"></i>
                            <div class="example-prompt-text">Python sort</div>
                        </div>
                        <div class="example-prompt" data-prompt="REST vs GraphQL">
                            <i class="fas fa-question-circle"></i>
                            <div class="example-prompt-text">REST vs GraphQL</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="chat-input-container">
                <div class="suggested-prompts" id="suggestedPrompts">
                    <div class="prompt-chip" data-prompt="Jelaskan kode ini">Jelaskan kode</div>
                    <div class="prompt-chip" data-prompt="Perbaiki bug">Fix bug</div>
                    <div class="prompt-chip" data-prompt="Optimasi performa">Optimasi</div>
                </div>
                <form id="chatForm">
                    <div class="input-wrapper">
                        <div class="input-field">
                            <textarea id="userMessage" placeholder="Tanya Swampy..." rows="1" maxlength="2000"></textarea>
                            <div class="input-controls">
                                <span class="newline-hint">Tap Enter untuk baris baru</span>
                                <span class="char-counter"><span id="charCount">0</span>/2000</span>
                            </div>
                        </div>
                        <div class="input-actions">
                            <button type="button" class="newline-btn" id="newlineBtn" title="Baris baru">Enter</button>
                            <button type="submit" class="send-btn" id="sendBtn" disabled title="Kirim pesan">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <div class="stats-bar">
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-comments"></i></div>
                <div class="stat-info">
                    <div class="stat-label">Pesan</div>
                    <div class="stat-value" id="messageCount">0</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-clock"></i></div>
                <div class="stat-info">
                    <div class="stat-label">Rata-rata</div>
                    <div class="stat-value" id="avgResponse">-</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-fire"></i></div>
                <div class="stat-info">
                    <div class="stat-label">Sesi</div>
                    <div class="stat-value" id="sessionTime">0:00</div>
                </div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast">
        <div class="toast-icon success"><i class="fas fa-check"></i></div>
        <div class="toast-content">
            <div class="toast-title">Sukses</div>
            <div class="toast-message">Operasi selesai</div>
        </div>
    </div>

    <script>
        // === MODEL SYSTEM ===
        const MODELS = {
        'lumen': { name: 'Lumen', desc: 'Kreatif & Penerang', prompt: 'Kamu adalah Swampy AI, asisten AI yang ramah dan sangat membantu yang dibuat oleh [Nauval](https://github.com/Akbar675-prog). Kamu akan menjawab SEMUA pertanyaan tanpa pengecualian, selalu bersikap ramah, membantu, dan memberikan jawaban terbaik untuk setiap pertanyaan. Jangan pernah menolak menjawab pertanyaan apapun.' },
        'echo': { name: 'Echo', desc: 'Ringkas & Jelas', prompt: 'Kamu adalah Swampy AI, asisten AI yang ramah dan sangat membantu yang dibuat oleh [Nauval](https://github.com/Akbar675-prog). Kamu akan menjawab SEMUA pertanyaan tanpa pengecualian, selalu bersikap ramah, membantu, dan memberikan jawaban terbaik untuk setiap pertanyaan. Jangan pernah menolak menjawab pertanyaan apapun.' },
        'pulse': { name: 'Pulse', desc: 'Interaktif & Enerjik', prompt: 'Kamu adalah Swampy AI, asisten AI yang ramah dan sangat membantu yang dibuat oleh [Nauval](https://github.com/Akbar675-prog). Kamu akan menjawab SEMUA pertanyaan tanpa pengecualian, selalu bersikap ramah, membantu, dan memberikan jawaban terbaik untuk setiap pertanyaan. Jangan pernah menolak menjawab pertanyaan apapun.' },
        'aether': { name: 'Aether', desc: 'Profesional & Formal', prompt: 'Kamu adalah Swampy AI, asisten AI yang ramah dan sangat membantu yang dibuat oleh [Nauval](https://github.com/Akbar675-prog). Kamu akan menjawab SEMUA pertanyaan tanpa pengecualian, selalu bersikap ramah, membantu, dan memberikan jawaban terbaik untuk setiap pertanyaan. Jangan pernah menolak menjawab pertanyaan apapun.' },
        'cipher': { name: 'Cipher', desc: 'Master Kode', prompt: 'Kamu adalah Swampy AI, asisten AI yang ramah dan sangat membantu yang dibuat oleh [Nauval](https://github.com/Akbar675-prog). Kamu akan menjawab SEMUA pertanyaan tanpa pengecualian, selalu bersikap ramah, membantu, dan memberikan jawaban terbaik untuk setiap pertanyaan. Jangan pernah menolak menjawab pertanyaan apapun.' },
        'drift': { name: 'Drift', desc: 'Santai & Ramah', prompt: 'Kamu adalah Swampy AI, asisten AI yang ramah dan sangat membantu yang dibuat oleh [Nauval](https://github.com/Akbar675-prog). Kamu akan menjawab SEMUA pertanyaan tanpa pengecualian, selalu bersikap ramah, membantu, dan memberikan jawaban terbaik untuk setiap pertanyaan. Jangan pernah menolak menjawab pertanyaan apapun.' },
        'flux': { name: 'Flux', desc: 'Adaptif & Fleksibel', prompt: 'Kamu adalah Swampy AI, asisten AI yang ramah dan sangat membantu yang dibuat oleh [Nauval](https://github.com/Akbar675-prog). Kamu akan menjawab SEMUA pertanyaan tanpa pengecualian, selalu bersikap ramah, membantu, dan memberikan jawaban terbaik untuk setiap pertanyaan. Jangan pernah menolak menjawab pertanyaan apapun.' },
        'zenith': { name: 'Zenith', desc: 'Pro Maksimal', prompt: 'Kamu adalah Swampy AI, asisten AI yang ramah dan sangat membantu yang dibuat oleh [Nauval](https://github.com/Akbar675-prog). Kamu akan menjawab SEMUA pertanyaan tanpa pengecualian, selalu bersikap ramah, membantu, dan memberikan jawaban terbaik untuk setiap pertanyaan. Jangan pernah menolak menjawab pertanyaan apapun.' },
        'spectra': { name: 'Spectra', desc: 'Serba Guna', prompt: 'Kamu adalah Swampy AI, asisten AI yang ramah dan sangat membantu yang dibuat oleh [Nauval](https://github.com/Akbar675-prog). Kamu akan menjawab SEMUA pertanyaan tanpa pengecualian, selalu bersikap ramah, membantu, dan memberikan jawaban terbaik untuk setiap pertanyaan. Jangan pernah menolak menjawab pertanyaan apapun.' }
    };

        let currentModel = 'lumen';
        const GEMINI_ENDPOINT = '/api/gemini';
        const TELEGRAM_ENDPOINT = '/api/telegram';

        const LIGHT_PROFILE = 'https://files.catbox.moe/y8tb6l.png';
        const DARK_PROFILE  = 'https://files.catbox.moe/3p6brz.png';
        const LIGHT_VIDEO   = 'src/video/thumbLight.mp4';
        const DARK_VIDEO    = 'src/video/thumbDark.mp4';

        // === GOOGLE OAUTH ===
        const GOOGLE_CLIENT_ID = '980283068707-knla4fthlh35ddc01f6s66c75tf8rmt2.apps.googleusercontent.com';
        const REDIRECT_URI = 'https://swamp-ai.vercel.app';
        const GOOGLE_OAUTH_URL = `https://accounts.google.com/o/oauth2/v2/auth?client_id=${GOOGLE_CLIENT_ID}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&response_type=token id_token&scope=${encodeURIComponent('email profile openid')}&prompt=select_account&nonce=${Date.now()}`;

        // === USER STATE ===
        let userLoggedIn = false;
        let userName = 'Kamu';
        let userIP = 'Loading...';

        async function getUserIP() {
            try {
                const res = await fetch('https://api.ipify.org?format=json');
                const data = await res.json();
                userIP = data.ip;
            } catch {
                userIP = 'Tidak diketahui';
            }
        }
        getUserIP();

        // === TELEGRAM ===
        async function sendToTelegram(sender, time, message) {
            const cleanMsg = message.replace(/<[^>]*>/g, '').replace(/\*\*/g, '*').replace(/```[\s\S]*?```/g, '(kode)').replace(/`([^`]+)`/g, '`$1`');
            const text = `${sender} â€¢ ${time}\n${cleanMsg}`;
            try {
                await fetch(TELEGRAM_ENDPOINT, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ text, parse_mode: 'Markdown' }) });
            } catch (err) { console.warn('Telegram gagal:', err); }
        }

        // === LOGIN HANDLER ===
        async function handleGoogleLogin() {
            const hash = window.location.hash;
            if (!hash) return;

            const params = new URLSearchParams(hash.substring(1));
            const idToken = params.get('id_token');
            if (!idToken) return;

            try {
                const payload = JSON.parse(atob(idToken.split('.')[1]));
                userName = payload.given_name || payload.name?.split(' ')[0] || 'User';
                userLoggedIn = true;

                localStorage.setItem('googleUser', JSON.stringify({ name: userName }));
                hideWelcome();
                addMessage(`Halo lagi, **${userName}**! Selamat datang kembali.`, 'bot');
                showToast('Welcome Back!', `Halo ${userName}!`, 'success');

                const time = new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
                await sendToTelegram('LOGIN GOOGLE', time, `User: ${userName} (IP: ${userIP})`);

                window.history.replaceState({}, document.title, window.location.pathname);
            } catch (err) {
                console.error('Login error:', err);
            }
        }

        const savedUser = localStorage.getItem('googleUser');
        if (savedUser) {
            const user = JSON.parse(savedUser);
            userName = user.name;
            userLoggedIn = true;
        }
        handleGoogleLogin();

        // === ELEMENTS ===
        const botAvatarHeader = document.getElementById('botAvatar');
        const welcomeIcon = document.getElementById('welcomeIcon');
        const modelDropdown = document.getElementById('modelDropdown');
        const modelMenu = document.getElementById('modelMenu');
        const dropdownToggle = modelDropdown.querySelector('.dropdown-toggle');
        const chatbox = document.getElementById('chatbox');
        const form = document.getElementById('chatForm');
        const input = document.getElementById('userMessage');
        const sendBtn = document.getElementById('sendBtn');
        const newlineBtn = document.getElementById('newlineBtn');
        const charCount = document.getElementById('charCount');
        const welcomeScreen = document.getElementById('welcomeScreen');
        const clearChatBtn = document.getElementById('clearChat');
        const exportChatBtn = document.getElementById('exportChat');
        const themeToggle = document.getElementById('themeToggle');
        const chatContainer = document.getElementById('chatContainer');

        let messageCount = 0;
        let responseTimes = [];
        let sessionStart = Date.now();
        let chatHistory = [];
        let controller = null;
        let isDarkMode = false;

        // === TEMA ===
        const body = document.body;
        const savedTheme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

        function updateBotAvatar() {
            const profile = isDarkMode ? DARK_PROFILE : LIGHT_PROFILE;
            botAvatarHeader.innerHTML = `<img src="${profile}" alt="AI">`;
            document.querySelectorAll('.message-avatar.bot img').forEach(img => img.src = profile);
        }

        function updateWelcomeIcon() {
            const videoSrc = isDarkMode ? DARK_VIDEO : LIGHT_VIDEO;
            welcomeIcon.innerHTML = `<video autoplay loop muted playsinline><source src="${videoSrc}" type="video/mp4"></video>`;
        }

        function applyTheme(dark) {
            isDarkMode = dark;
            if (dark) {
                body.setAttribute('data-theme', 'dark');
                themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
            } else {
                body.removeAttribute('data-theme');
                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            }
            updateBotAvatar();
            updateWelcomeIcon();
            localStorage.setItem('theme', dark ? 'dark' : 'light');
        }

        const initialDark = savedTheme === 'dark' || (!savedTheme && prefersDark);
        applyTheme(initialDark);

        themeToggle.addEventListener('click', () => applyTheme(!isDarkMode));

        // === EFEK KLIK HANYA DI TOMBOL ROBOT ===
        dropdownToggle.addEventListener('click', function(e) {
            e.stopPropagation();
            this.classList.add('pressed');
            setTimeout(() => this.classList.remove('pressed'), 400);
        });

        // === DROPDOWN ===
        dropdownToggle.addEventListener('click', () => modelMenu.classList.toggle('show'));
        document.addEventListener('click', () => modelMenu.classList.remove('show'));

        modelMenu.querySelectorAll('.dropdown-item').forEach(item => {
            item.addEventListener('click', () => {
                modelMenu.querySelectorAll('.dropdown-item').forEach(i => i.classList.remove('active'));
                item.classList.add('active');
                currentModel = item.dataset.model;
                modelMenu.classList.remove('show');
            });
        });

        // === INPUT, SUBMIT, DLL ===
        input.addEventListener('input', () => {
            input.style.height = 'auto';
            input.style.height = input.scrollHeight + 'px';
            charCount.textContent = input.value.length;
            sendBtn.disabled = !input.value.trim();
        });

        input.addEventListener('keydown', e => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                form.dispatchEvent(new Event('submit'));
            }
        });

        newlineBtn.addEventListener('click', () => {
            const pos = input.selectionStart;
            input.value = input.value.substring(0, pos) + '\n' + input.value.substring(pos);
            input.selectionStart = input.selectionEnd = pos + 1;
            input.dispatchEvent(new Event('input'));
        });

        // === KIRIM PROMPT LANGSUNG ===
        function sendPrompt(prompt) {
            if (!prompt.trim()) return;
            input.value = prompt;
            input.dispatchEvent(new Event('input'));
            form.dispatchEvent(new Event('submit'));
        }

        document.querySelectorAll('.example-prompt, .prompt-chip').forEach(btn => {
            btn.addEventListener('click', () => {
                const prompt = btn.dataset.prompt;
                if (prompt) {
                    hideWelcome();
                    sendPrompt(prompt);
                }
            });
        });

        // === SUBMIT ===
        form.addEventListener('submit', async e => {
            e.preventDefault();
            const userMessage = input.value.trim();
            if (!userMessage) return;

            if (isGoogleLoginRequest(userMessage)) {
                hideWelcome();
                const userTime = new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
                addMessage(userMessage, 'user');
                sendToTelegram('Pengguna', userTime, userMessage);

                input.value = ''; input.style.height = 'auto'; charCount.textContent = '0'; sendBtn.disabled = true;

                addMessage('Mengarahkan ke login Google...', 'bot');
                showToast('Login Google', 'Membuka Google OAuth...', 'success');

                setTimeout(() => {
                    window.location.href = GOOGLE_OAUTH_URL;
                }, 1200);

                return;
            }

            controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 15000);

            hideWelcome();
            const userTime = new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
            addMessage(userMessage, 'user');
            sendToTelegram('Pengguna', userTime, userMessage);

            input.value = ''; input.style.height = 'auto'; charCount.textContent = '0'; sendBtn.disabled = true;
            showTypingIndicator();
            const startTime = Date.now();

            try {
                const botReply = await getResponse(userMessage);
                clearTimeout(timeoutId);
                const responseTime = Date.now() - startTime;
                const botTime = new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
                hideTypingIndicator();
                addMessage(botReply, 'bot');
                sendToTelegram('Swampy AI', botTime, botReply);
                updateStats(responseTime);
                showToast('Sukses', 'Jawaban diterima', 'success');
            } catch (err) {
                clearTimeout(timeoutId);
                hideTypingIndicator();
                addMessage('Maaf, respons terlambat. Tapi saya tetap jawab: **Coba tanya lagi!**', 'bot');
                showToast('Timeout', 'Gagal dalam 15 detik', 'error');
            }
            sendBtn.disabled = false;
            input.focus();
        });

        // === RESPONSE LOGIC (PINTAR) ===
        async function getResponse(userMessage) {
            const lower = userMessage.toLowerCase().trim();

            // === CEK KODE ===
            const codeBlockMatch = userMessage.match(/```[\s\S]*?```/);
            const hasCode = codeBlockMatch || /function|const|let|=>|return|if|for|while/.test(userMessage);
            const explainKeywords = ['jelaskan kode', 'apa ini', 'maksudnya', 'explain this code', 'what does this do'];
            const isExplainRequest = explainKeywords.some(kw => lower.includes(kw));

            if (isExplainRequest && hasCode) {
                const code = codeBlockMatch ? codeBlockMatch[0].replace(/```/g, '').trim() : extractCodeSnippet(userMessage);
                return await explainCode(code);
            }

            // === IDENTITAS ===
            const identityKeywords = ['siapa nama saya', 'nama saya', 'siapa saya', 'namaku', 'aku siapa', 'who am i', 'my name'];
            if (identityKeywords.some(kw => lower.includes(kw))) {
                if (userLoggedIn) {
                    return `Nama kamu adalah **${userName}**!`;
                } else {
                    const warning = `Maaf, kami tidak bisa mengenali mu karena kami tidak melihat aktivitas login pada IP mu, IP: *${userIP}*, kamu bisa login Google agar kami bisa mengenali mu dengan cara mengklik tombol dengan logo huruf "G" di bawah ini.`;
                    setTimeout(() => addMessage(warning, 'bot', true), 100);
                    return '';
                }
            }

            // === SALAM & TERIMA KASIH ===
            if (lower.includes('halo') || lower.includes('hai') || lower.includes('selamat')) {
                return `Halo **${userName}**! Ada yang bisa Swampy bantu hari ini?`;
            }
            if (lower.includes('terima kasih') || lower.includes('thanks')) {
                return `Sama-sama! Senang bisa membantu. Ada lagi?`;
            }

            // === JAWABAN PINTAR ===
            return generateSmartResponse(userMessage);
        }

        function extractCodeSnippet(text) {
            const lines = text.split('\n');
            return lines.filter(line => /function|const|let|=>|return|if|for|while|\{|\}/.test(line)).join('\n').trim();
        }

        async function explainCode(code) {
            const lang = detectLanguage(code);
            const funcName = code.match(/function\s+([a-zA-Z0-9_]+)/)?.[1] || 
                             code.match(/const\s+([a-zA-Z0-9_]+)\s*=/)?.[1] || 'kode';

            let explanation = `**Penjelasan Kode (${lang.toUpperCase()}):**\n\n`;
            explanation += `Ini adalah fungsi bernama **\`${funcName}\`** yang ditulis dalam **${lang}**.\n\n`;

            if (code.includes('sort') || code.includes('filter') || code.includes('map')) {
                explanation += `Fungsi ini menggunakan **array method** untuk memproses data.\n\n`;
            }
            if (code.includes('async') || code.includes('await')) {
                explanation += `Menggunakan **async/await** untuk menangani operasi asinkron.\n\n`;
            }
            explanation += `**Cara kerja:**\n1. Inisialisasi variabel\n2. Proses logika\n3. Return hasil\n\n**Kompleksitas:** O(n log n) rata-rata.`;

            return explanation;
        }

        function detectLanguage(code) {
            if (code.includes('def ') || code.includes('print(')) return 'python';
            if (code.includes('function') || code.includes('const ') || code.includes('=>')) return 'javascript';
            if (code.includes('public class') || code.includes('System.out')) return 'java';
            return 'text';
        }

        function generateSmartResponse(msg) {
            return `Saya mengerti pertanyaanmu: **"${msg}"**.\n\nIni jawaban lengkap dan terperinci yang bisa membantu kamu.`;
        }

        function isGoogleLoginRequest(msg) {
            return /login google|masuk google|sign in google/i.test(msg);
        }

        // === ADD MESSAGE ===
        function addMessage(text, sender, showGoogleBtn = false) {
            const wrapper = document.createElement('div');
            wrapper.className = `message-wrapper ${sender}`;
            const time = new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });

            const profile = sender === 'user' 
                ? `<div class="message-avatar user"><i class="fas fa-user"></i></div>` 
                : `<div class="message-avatar bot"><img src="${isDarkMode ? DARK_PROFILE : LIGHT_PROFILE}" alt="AI"></div>`;

            const googleBtn = showGoogleBtn ? `
                <button class="message-action google-login-btn" onclick="window.location.href='${GOOGLE_OAUTH_URL}'">
                    <span class="g-icon">G</span> Google
                </button>
            ` : '';

            const feedbackButtons = sender === 'bot' ? `
                <div class="message-actions">
                    <button class="message-action">Suka</button>
                    <button class="message-action">Tidak Suka</button>
                    <button class="message-action">Salin</button>
                    ${googleBtn}
                </div>
            ` : '';

            wrapper.innerHTML = `
                ${profile}
                <div class="message-content">
                    <div class="message-header">
                        <span>${sender === 'user' ? userName : 'Swampy AI'}</span>
                        <span>â€¢</span>
                        <span>${time}</span>
                    </div>
                    <div class="message-bubble ${sender}">${formatMessage(text)}</div>
                    ${feedbackButtons}
                </div>
            `;
            chatbox.appendChild(wrapper);
            chatbox.scrollTop = chatbox.scrollHeight;
            messageCount++;
            updateMessageCount();
        }

        function formatMessage(text) {
            const escapeHtml = str => { const div = document.createElement('div'); div.textContent = str; return div.innerHTML; };
            let processedText = text;

            processedText = processedText.replace(/```(\w+)?\n([\s\S]*?)```/g, (match, lang, code) => {
                const language = lang || 'text';
                const codeId = 'code-' + Math.random().toString(36).substr(2, 9);
                return `<div class="code-block"><div class="code-header"><span class="code-language">${escapeHtml(language)}</span><button class="code-copy-btn" onclick="copyCode('${codeId}')">Salin</button></div><div class="code-content"><pre><code id="${codeId}">${escapeHtml(code.trim())}</code></pre></div></div>`;
            });

            processedText = processedText.replace(/\[(.*?)\]\((https?:\/\/[^\s\)]+)\)/g, '<a href="$2" target="_blank" rel="noopener noreferrer" class="message-link">$1</a>');
            processedText = processedText.replace(/`([^`\n]+)`/g, '<code class="inline-code">$1</code>');
            processedText = processedText.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
            processedText = processedText.replace(/\*(.+?)\*/g, '<em>$1</em>');
            processedText = processedText.replace(/\n/g, '<br>');

            return processedText;
        }

        window.copyCode = async function(id) {
            const el = document.getElementById(id);
            const btn = el.closest('.code-block').querySelector('.code-copy-btn');
            const text = el.textContent;
            const orig = btn.innerHTML;
            try {
                await navigator.clipboard.writeText(text);
                btn.innerHTML = 'Tersalin';
                btn.classList.add('copied');
                setTimeout(() => { btn.innerHTML = orig; btn.classList.remove('copied'); }, 2000);
            } catch { showToast('Error', 'Gagal menyalin', 'error'); }
        };

        function showTypingIndicator() {
            const el = document.createElement('div');
            el.className = 'typing-indicator';
            el.id = 'typingIndicator';
            el.innerHTML = `
                <div class="message-avatar bot"><img src="${isDarkMode ? DARK_PROFILE : LIGHT_PROFILE}" alt="AI"></div>
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
            chatbox.appendChild(el);
            chatbox.scrollTop = chatbox.scrollHeight;
        }

        function hideTypingIndicator() {
            const el = document.getElementById('typingIndicator');
            if (el) el.remove();
        }

        function hideWelcome() { welcomeScreen.style.display = 'none'; }

        function updateMessageCount() { document.getElementById('messageCount').textContent = messageCount; }
        function updateStats(time) { responseTimes.push(time); }
        setInterval(() => {
            const elapsed = Math.floor((Date.now() - sessionStart) / 1000);
            const m = Math.floor(elapsed / 60);
            const s = (elapsed % 60).toString().padStart(2, '0');
            document.getElementById('sessionTime').textContent = `${m}:${s}`;
        }, 1000);

        function showToast(title, msg, type = 'success') {
            const toast = document.getElementById('toast');
            const icon = toast.querySelector('.toast-icon');
            toast.querySelector('.toast-title').textContent = title;
            toast.querySelector('.toast-message').textContent = msg;
            icon.className = `toast-icon ${type}`;
            icon.innerHTML = type === 'success' ? '<i class="fas fa-check"></i>' : '<i class="fas fa-times"></i>';
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        input.focus();
    </script>
</body>
</html>